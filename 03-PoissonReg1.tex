\documentclass[MASTER.tex]{subfiles}
\begin{document}

%
%This page uses the following packages. Make sure that you can load them before trying to run the examples on this page. 
%If you do not have a package installed, run: install.packages("packagename"), or if you see the version is out of date, run: update.packages().
 
\begin{frame}
	%R Data Analysis Examples: Poisson Regression
	
	{\LARGE
	PART 2:	Poisson Regression
	} \bigskip
	\Large
	
	\medskip
	\begin{itemize}
		\item Poisson regression is used to model count variables.
		\item Poisson regression has a number of extensions useful for count models.

	\end{itemize}
\end{frame}
%================================================================================================%
\begin{frame}[fragile]
	
	\frametitle{Poisson Regression with \texttt{R}}
	\Large
	\textbf{Conventional OLS regression}
	\begin{itemize}
		\item Count outcome variables are sometimes log-transformed and analyzed using OLS regression. 
		\item Many issues arise with this approach, including loss of data due to undefined values generated by taking the log of zero (which is undefined) and biased estimates.
	\end{itemize}
	\bigskip
\end{frame}

\begin{frame}
	\frametitle{Poisson Regression with \texttt{R}}
	\large
If $\mathbf{x} \in \mathbb{R}^n$ is a vector of independent variables, then the model takes the form
{
	\Large
\[\log_e (\operatorname{E}(Y\mid\mathbf{x}))= \beta_0 + \beta_1 x_1 + \ldots + \beta_n x_n  \]

\[\operatorname{E}(Y\mid\mathbf{x})= e^{\beta_0 + \beta_1 x_1 + \ldots + \beta_n x_n } \]

\[\operatorname{E}(Y\mid\mathbf{x})= e^{\beta_0 + \beta_1 x_1 + \ldots + \beta_n x_n } \]

\[\operatorname{E}(Y\mid\mathbf{x})= e^{\beta_0} \times e^{\beta_1 x_1} \times \ldots \times e^{\beta_n x_n} \]
}
\end{frame}

%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\textbf{The Crabs Data Set}\\
	The crabs data set is derived from Agresti \textit{(2007, Table 3.2, pp.76-77)}. It gives 4 variables for each of 173 female horseshoe crabs.
	\begin{itemize}
		\item \textbf{Satellites}
		number of male partners in addition to the female's primary partner
		
		\item \textbf{Width}
		width of the female in centimeters
		
		\item \textbf{Dark}
		a binary factor indicating whether the female has dark coloring (yes or no)
		
		\item \textbf{GoodSpine}
		a binary factor indicating whether the female has good spine condition (yes or no)
	\end{itemize} \smallskip
	\noindent Let the first variable be a response variable, with the other three as predictors.
\end{frame}
%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\large
	The data is containted in the \texttt{R} package \textbf{\textit{glm2}}
	\begin{framed}
		\begin{verbatim}
		require(glm2)
		
		data(crabs)
		head(crabs)
		
		summary(crabs[,1:4])
		\end{verbatim}
	\end{framed}
\end{frame}
%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\large
	\begin{verbatim}
	> head(crabs)
	  Satellites   Width   Dark GoodSpine  Rep1 Rep2
	1          8    28.3    no        no     2    2
	2          0    22.5   yes        no     4    5
	3          9    26.0    no       yes     5    6
	4          0    24.8   yes        no     6    6
	5          4    26.0   yes        no     6    8
	....
	\end{verbatim}
\end{frame}
%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\begin{verbatim}
	> summary(crabs[,1:4])
	Satellites         Width       Dark     GoodSpine
	Min.   : 0.000   Min.   :21.0   no :107   no :121  
	1st Qu.: 0.000   1st Qu.:24.9   yes: 66   yes: 52  
	Median : 2.000   Median :26.1                      
	Mean   : 2.919   Mean   :26.3                      
	3rd Qu.: 5.000   3rd Qu.:27.7                      
	Max.   :15.000   Max.   :33.5                
	
	\end{verbatim}
\end{frame}
%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\begin{itemize}
		\item Fit a Poisson regression model with the number of Satellites as the outcome and the width of the female as the covariate. 
		
		\item What is the multiplicative change in the expected number of crabs for each additional centimeter of width?
	\end{itemize}
	\begin{framed}
		\begin{verbatim}
		crabs.pois <- glm2(Satellites ~ Width, 
		data=crabs, family="poisson")
		summary(crabs.pois)
		
		exp(0.164)
		\end{verbatim}
	\end{framed}
	
\end{frame}
%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\begin{verbatim}
	> summary(crabs.pois)
	
	Call:
	glm2(formula = Satellites ~ Width, 
	family = "poisson", data = crabs)
	
	...... 
	......
	Coefficients:
	Estimate Std. Error z value Pr(>|z|)    
	(Intercept) -3.30476    0.54224  -6.095  1.1e-09 ***
	Width        0.16405    0.01997   8.216  < 2e-16 ***
	---
	...... 
	\end{verbatim}
	
\end{frame}
%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\begin{figure}[h!]
		\centering
		\includegraphics[width=1.05\linewidth]{./DAquiz5Q3c}
		%\caption{}
		%\label{fig:DAquiz5Q3c}
	\end{figure}
\end{frame}
%================================================================== %
\begin{frame}[fragile]
	\frametitle{Poisson Regression :  Crabs Example}
	\large
	\textbf{Code for Crabs Data Plot}
	\begin{framed}
		\begin{verbatim}
		plot(crabs$Width, crabs$Satellites,
		   pch=16, col="darkred")
		   points(crabs$Width, crabs.pois$fitted.values, 
		   col="green", lwd=3)
		\end{verbatim}
	\end{framed}
\end{frame}

%%================================================================================================%
%\begin{frame}[fragile]
%
%\frametitle{Poisson Regression with \texttt{R}}
%\Large 
%Please note: The purpose of this page is to show how to use various data analysis commands. It does not cover all aspects of the research process which researchers are expected to do. In particular, it does not cover data cleaning and checking, verification of assumptions, model diagnostics or potential follow-up analyses.
%\end{frame}

 %================================================================================================%
\begin{frame}[fragile]

\frametitle{Poisson Regression with \texttt{R} } 
 
 \Large	
 
 \textbf{Other Examples of Poisson regression} \\
 	
 \begin{itemize}	
 \item The number of awards earned by students at a secondary or high school. 
 \item Predictors of the number of awards earned include the type of program in which the student was enrolled (e.g., vocational, general or academic) and the score on their final exam in math.
 \end{itemize}
 
\end{frame}



%================================================================================================%
\begin{frame}[fragile]

\frametitle{Poisson Regression with \texttt{R}}
\Large
\textbf{Description of the data}

\begin{itemize}
\item For the purpose of illustration, we have simulated a data set for the last example.

\item The data set is called \textit{poisreg.csv}  

\item In this example, \textbf{num\_awards} is the outcome variable and indicates the number of awards earned by students at a high school in a year.

\end{itemize}
\end{frame}
%================================================================================================%
\begin{frame}[fragile]
	
	\frametitle{Poisson Regression with \texttt{R}}
	\Large
	\textbf{Predictor Variables}
\begin{itemize}
\item \textbf{math} is a continuous predictor variable and represents students' scores on their math final exam, \item \textbf{prog} is a categorical predictor variable with three levels indicating the type of program in which the students were enrolled.

\item  \textbf{prog} is coded as 1 = "\textit{General}",
 2 = "\textit{Academic}" and 3 = "\textit{Vocational}". 
\end{itemize}
% Let's start with loading the data and looking at some descriptive statistics.

\end{frame}

%%================================================================================================%
%\begin{frame}[fragile]
%
%\frametitle{Poisson Regression with \texttt{R}}
%\Large
%
%\begin{verbatim}
%p <- read.csv("http://www.ats.ucla.edu/stat/data/poisson_sim.csv")
%p <- within(p, {
%  prog <- factor(prog, levels=1:3, labels=c("General", "Academic", "Vocational"))
%  id <- factor(id)
%})
%summary(p)
%\end{verbatim}
%\end{frame}

%================================================================================================%
\begin{frame}[fragile]
	
\frametitle{Poisson Regression with \texttt{R}}
\normalsize
	\begin{verbatim}
        id        num_awards           prog          math     
1    :  1   Min.   :0.00   General   : 45   Min.   :33.0  
2    :  1   1st Qu.:0.00   Academic  :105   1st Qu.:45.0  
3    :  1   Median :0.00   Vocational: 50   Median :52.0  
4    :  1   Mean   :0.63                    Mean   :52.6  
5    :  1   3rd Qu.:1.00                    3rd Qu.:59.0  
6    :  1   Max.   :6.00                    Max.   :75.0  
  (Other):194
\end{verbatim}
\end{frame}
%================================================== %	
\begin{frame}
	\begin{figure}
		\centering
		\includegraphics[width=0.8\linewidth]{poisson1}
		\caption{}
		\label{fig:poisson1}
	\end{figure}
	
	
\end{frame}
%================================================================================================%
\begin{frame}[fragile]

\frametitle{Poisson Regression with \texttt{R}}
\Large

\begin{itemize}
\item Each variable has 200 valid observations and their distributions seem quite reasonable. 
\item The mean and variance of our outcome variable are more or less the same. 
\item Our model assumes that these values, conditioned on the predictor variables, will be equal (or at least roughly so).
\end{itemize}
\end{frame}
%================================================================================================%
%\begin{frame}[fragile]
%\frametitle{Poisson Regression with \texttt{R}}
%We can use the tapply function to display the summary statistics by program type. The table below shows the average numbers of awards by program type and seems to suggest that program type is a good candidate for predicting the number of awards, our outcome variable, because the mean value of the outcome appears to vary by prog.
%\end{frame}
%\end{document}
%================================================================================================%
%\begin{frame}[fragile]
%\frametitle{Poisson Regression with \texttt{R}}
%\Large
%\begin{itemize}
%\item Additionally, the means and variances within each level of prog--\textit{the conditional means and variances}--are similar. 
%\item A conditional histogram separated out by program type is plotted to show the distribution.
%\end{itemize}
%
%
%\end{frame}

%%================================================================================================%
%\begin{frame}[fragile]
%
%\frametitle{Poisson Regression with \texttt{R}}
%\Large
%
%\begin{verbatim}
%
%ggplot(p, aes(num_awards, fill = prog)) +
%  geom_histogram(binwidth=.5, position="dodge")
%
%\end{verbatim}
%
% \end{frame}
%================================================================================================%
		
%with(p, tapply(num_awards, prog, function(x) {
%	sprintf("M (SD) = %1.2f (%1.2f)", mean(x), sd(x))
%}))
%
%General               Academic             Vocational 
%"M (SD) = 0.20 (0.40)" "M (SD) = 1.00 (1.28)" "M (SD) = 0.24 (0.52)"



\end{document}